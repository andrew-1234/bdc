<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Prefilter • bdc</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cosmo/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Prefilter">
<meta property="og:description" content="bdc">
<meta property="og:image" content="https://brunobrr.github.io/bdc/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">bdc</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Functions</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fas fa-book"></span>
     
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/00_integrate_datasets.html">Standardization and integration of different datasets</a>
    </li>
    <li>
      <a href="../articles/01_prefilter.html">Prefilter</a>
    </li>
    <li>
      <a href="../articles/02_taxonomy.html">Taxonomy</a>
    </li>
    <li>
      <a href="../articles/03_space.html">Space</a>
    </li>
    <li>
      <a href="../articles/04_time.html">Time</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="01_prefilter_files/header-attrs-2.11/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Prefilter</h1>
            
            <h4 class="date">2022-02-10</h4>
      
      
      <div class="hidden name"><code>01_prefilter.Rmd</code></div>

    </div>

    
    
<div id="introduction" class="section level2">
<h2 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h2>
<p>Large and heterogeneous datasets may contain thousands of records missing spatial or taxonomic information (partially or entirely) as well as several records outside a region of interest or from doubtful sources. Such lower quality data are not fit for use in many research applications without prior amendments. The ‘Pre-filter’ module contains a series of <strong>tests to detect, remove, and, whenever, possible, correct such erroneous or suspect records</strong>.</p>
<p><br></p>
<p><img src="https://img.icons8.com/windows/96/000000/box-important--v1.png" width="40"><strong>Important</strong>:</p>
<p>The results of the <strong>VALIDATION</strong> test used to flag data quality are appended in separate fields in this database and retrieved as TRUE or <strong>FALSE</strong>, in which the former indicates correct records and the <strong>latter potentially problematic or suspect records.</strong></p>
</div>
<div id="installation" class="section level2">
<h2 class="hasAnchor">
<a href="#installation" class="anchor"></a>Installation</h2>
<p>You can install the released version of <em>bdc</em> from <a href="https://github.com/brunobrr/bdc">github</a> with:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span><span class="op">(</span><span class="st">"remotes"</span><span class="op">)</span>
<span class="fu">remotes</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html">install_github</a></span><span class="op">(</span><span class="st">"brunobrr/bdc"</span><span class="op">)</span></code></pre></div>
<p>And load the package with:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">bdc</span><span class="op">)</span></code></pre></div>
</div>
<div id="creating-directories" class="section level2">
<h2 class="hasAnchor">
<a href="#creating-directories" class="anchor"></a>Creating directories</h2>
<p>Create directories to save the results of the functions. If not existing, four new folders are created in a folder named ‘Output’.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/bdc_create_dir.html">bdc_create_dir</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
</div>
<div id="reading-the-database" class="section level2">
<h2 class="hasAnchor">
<a href="#reading-the-database" class="anchor"></a>Reading the database</h2>
<p>Read the merged database created in the module <strong>Standardization and integration of different datasets</strong> of the <em>bdc</em> package. It is also possible to read any datasets containing the <strong>required</strong> fields to run the functions (more details <a href="https://brunobrr.github.io/bdc/articles/integrate_datasets.html%22">here</a>).</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">database</span> <span class="op">&lt;-</span>
  <span class="fu">qs</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/qs/man/qread.html">qread</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="st">"Output/Intermediate/00_merged_database.qs"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>#&gt; [1] ""</code></pre>
<p>Standardization of character encoding.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span><span class="op">(</span><span class="va">database</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
  <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/character.html">is.character</a></span><span class="op">(</span><span class="va">database</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
    <span class="fu"><a href="https://rdrr.io/r/base/Encoding.html">Encoding</a></span><span class="op">(</span><span class="va">database</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="st">"UTF-8"</span>
  <span class="op">}</span>
<span class="op">}</span></code></pre></div>
<p><br></p>
<p><br></p>
</div>
<div id="records-missing-species-names" class="section level2">
<h2 class="hasAnchor">
<a href="#records-missing-species-names" class="anchor"></a>1 - Records missing species names</h2>
<p><em>VALIDATION</em>. Flag records missing species names.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">check_pf</span> <span class="op">&lt;-</span>
  <span class="fu"><a href="../reference/bdc_scientificName_empty.html">bdc_scientificName_empty</a></span><span class="op">(</span>
  data <span class="op">=</span> <span class="va">database</span>,
  sci_name <span class="op">=</span> <span class="st">"scientificName"</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; bdc_scientificName_empty:</span>
<span class="co">#&gt; Flagged 324 records.</span>
<span class="co">#&gt; One column was added to the database.</span></code></pre></div>
</div>
<div id="records-lacking-information-on-geographic-coordinates" class="section level2">
<h2 class="hasAnchor">
<a href="#records-lacking-information-on-geographic-coordinates" class="anchor"></a>2 - Records lacking information on geographic coordinates</h2>
<p><em>VALIDATION</em>. Flag records missing partial or complete information on geographic coordinates.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">check_pf</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bdc_coordinates_empty.html">bdc_coordinates_empty</a></span><span class="op">(</span>
  data <span class="op">=</span> <span class="va">check_pf</span>,
  lat <span class="op">=</span> <span class="st">"decimalLatitude"</span>,
  lon <span class="op">=</span> <span class="st">"decimalLongitude"</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; bdc_coordinates_empty:</span>
<span class="co">#&gt; Flagged 1921 records.</span>
<span class="co">#&gt; One column was added to the database.</span></code></pre></div>
</div>
<div id="records-with-out-of-range-coordinates" class="section level2">
<h2 class="hasAnchor">
<a href="#records-with-out-of-range-coordinates" class="anchor"></a>3 - Records with out-of-range coordinates</h2>
<p><em>VALIDATION</em>. This test flags records with out-of-range coordinates: latitude &gt; 90 or -90; longitude &gt;180 or -180.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">check_pf</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bdc_coordinates_outOfRange.html">bdc_coordinates_outOfRange</a></span><span class="op">(</span>
  data <span class="op">=</span> <span class="va">check_pf</span>,
  lat <span class="op">=</span> <span class="st">"decimalLatitude"</span>,
  lon <span class="op">=</span> <span class="st">"decimalLongitude"</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; bdc_coordinates_outOfRange:</span>
<span class="co">#&gt; Flagged 23 records.</span>
<span class="co">#&gt; One column was added to the database.</span></code></pre></div>
</div>
<div id="records-from-doubtful-sources" class="section level2">
<h2 class="hasAnchor">
<a href="#records-from-doubtful-sources" class="anchor"></a>4 - Records from doubtful sources</h2>
<p><em>VALIDATION</em>. This test flags records from doubtful source. For example, records from drawings, photographs, or multimedia objects, fossil records, among others.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">check_pf</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bdc_basisOfRecords_notStandard.html">bdc_basisOfRecords_notStandard</a></span><span class="op">(</span>
  data <span class="op">=</span> <span class="va">check_pf</span>,
  basisOfRecord <span class="op">=</span> <span class="st">"basisOfRecord"</span>,
  names_to_keep <span class="op">=</span> <span class="st">"all"</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; bdc_basisOfRecords_notStandard:</span>
<span class="co">#&gt; Flagged 5 of the following specific nature:</span>
<span class="co">#&gt;  c("FOSSIL_SPECIMEN", "Extra", "Liqui") </span>
<span class="co">#&gt; One column was added to the database.</span></code></pre></div>
</div>
<div id="getting-country-names-from-valid-coordinates" class="section level2">
<h2 class="hasAnchor">
<a href="#getting-country-names-from-valid-coordinates" class="anchor"></a>5 - Getting country names from valid coordinates</h2>
<p><em>ENRICHMENT</em>. Deriving country names for records missing country names.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">check_pf</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bdc_country_from_coordinates.html">bdc_country_from_coordinates</a></span><span class="op">(</span>
  data <span class="op">=</span> <span class="va">check_pf</span>,
  lat <span class="op">=</span> <span class="st">"decimalLatitude"</span>,
  lon <span class="op">=</span> <span class="st">"decimalLongitude"</span>,
  country <span class="op">=</span> <span class="st">"country"</span><span class="op">)</span>
<span class="co">#&gt; Carregando pacotes exigidos: rnaturalearth</span>
<span class="co">#&gt; Carregando pacotes exigidos: rnaturalearthdata</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; bdc_country_from_coordinates:</span>
<span class="co">#&gt; Country names were added to 1525 records.</span></code></pre></div>
</div>
<div id="standardizing-country-names-and-getting-country-code-information" class="section level2">
<h2 class="hasAnchor">
<a href="#standardizing-country-names-and-getting-country-code-information" class="anchor"></a>6 - Standardizing country names and getting country code information</h2>
<p><em>ENRICHMENT</em>. Country names are standardized against a list of country names in several languages retrieved from Wikipedia.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">check_pf</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bdc_country_standardized.html">bdc_country_standardized</a></span><span class="op">(</span>
  data <span class="op">=</span> <span class="va">check_pf</span>,
  country <span class="op">=</span> <span class="st">"country"</span>
<span class="op">)</span>
<span class="co">#&gt; Loading auxiliary data: country names from wikipedia</span>
<span class="co">#&gt; Loading auxiliary data: world map and country iso</span>
<span class="co">#&gt; Standardizing country names</span>
<span class="co">#&gt; country found: Argentina</span>
<span class="co">#&gt; country found: Belize</span>
<span class="co">#&gt; country found: Bolivia</span>
<span class="co">#&gt; country found: Brazil</span>
<span class="co">#&gt; country found: Colombia</span>
<span class="co">#&gt; country found: Ecuador</span>
<span class="co">#&gt; country found: France</span>
<span class="co">#&gt; country found: French Guiana</span>
<span class="co">#&gt; country found: Guyana</span>
<span class="co">#&gt; country found: Honduras</span>
<span class="co">#&gt; country found: Japan</span>
<span class="co">#&gt; country found: Mexico</span>
<span class="co">#&gt; country found: Nicaragua</span>
<span class="co">#&gt; country found: Paraguay</span>
<span class="co">#&gt; country found: Suriname</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; bdc_country_standardized:</span>
<span class="co">#&gt; The country names of 3541 records were standardized.</span>
<span class="co">#&gt; Two columns ('country_suggested' and 'countryCode') were added to the database.</span></code></pre></div>
</div>
<div id="correcting-latitude-and-longitude-transposed" class="section level2">
<h2 class="hasAnchor">
<a href="#correcting-latitude-and-longitude-transposed" class="anchor"></a>7 - Correcting latitude and longitude transposed</h2>
<p><em>AMENDMENT</em>. The mismatch between informed country and coordinates can be the result of negative or transposed coordinates. Once detected a mismatch, different coordinate transformations are made to correct the country and coordinates mismatch. Verbatim coordinates are then replaced by the rectified ones in the returned database (a database containing verbatim and corrected coordinates is also created in the “Output” folder). Records near countries coastline are not tested to avoid incur in false positives.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">check_pf</span> <span class="op">&lt;-</span>
  <span class="fu"><a href="../reference/bdc_coordinates_transposed.html">bdc_coordinates_transposed</a></span><span class="op">(</span>
    data <span class="op">=</span> <span class="va">check_pf</span>,
    id <span class="op">=</span> <span class="st">"database_id"</span>,
    sci_names <span class="op">=</span> <span class="st">"scientificName"</span>,
    lat <span class="op">=</span> <span class="st">"decimalLatitude"</span>,
    lon <span class="op">=</span> <span class="st">"decimalLongitude"</span>,
    country <span class="op">=</span> <span class="st">"country_suggested"</span>,
    countryCode <span class="op">=</span> <span class="st">"countryCode"</span>,
    border_buffer <span class="op">=</span> <span class="fl">0.2</span> <span class="co"># in decimal degrees (~22 km at the equator)</span>
  <span class="op">)</span>
<span class="co">#&gt; Carregando pacotes exigidos: readr</span>
<span class="co">#&gt; Correcting latitude and longitude transposed</span>
<span class="co">#&gt; 698 ocurrences will be tested</span>
<span class="co">#&gt; Processing occurrences from: BR (695)</span>
<span class="co">#&gt; Processing occurrences from: CO (1)</span>
<span class="co">#&gt; Processing occurrences from: MX (1)</span>
<span class="co">#&gt; Processing occurrences from: VE (1)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; bdc_coordinates_transposed:</span>
<span class="co">#&gt; Corrected 19 records.</span>
<span class="co">#&gt; One columns were added to the database.</span>
<span class="co">#&gt; Check database containing coordinates corrected in:</span>
<span class="co">#&gt; Output/Check/01_coordinates_transposed.csv</span></code></pre></div>
</div>
<div id="records-outside-a-region-of-interest" class="section level2">
<h2 class="hasAnchor">
<a href="#records-outside-a-region-of-interest" class="anchor"></a>8 - Records outside a region of interest</h2>
<p><em>VALIDATION</em>. Records outside one or multiple reference countries; i.e., records in other countries or at an informed distance from the coast (e.g., in the ocean). This last step avoids flagging as invalid records close to country limits (e.g., records of coast or marshland species).</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">check_pf</span> <span class="op">&lt;-</span>
  <span class="fu"><a href="../reference/bdc_coordinates_country_inconsistent.html">bdc_coordinates_country_inconsistent</a></span><span class="op">(</span>
    data <span class="op">=</span> <span class="va">check_pf</span>,
    country_name <span class="op">=</span> <span class="st">"Brazil"</span>,
    lon <span class="op">=</span> <span class="st">"decimalLongitude"</span>,
    lat <span class="op">=</span> <span class="st">"decimalLatitude"</span>,
    dist <span class="op">=</span> <span class="fl">0.1</span> <span class="co"># in decimal degrees (~11 km at the equator)</span>
  <span class="op">)</span>
<span class="co">#&gt; Spherical geometry (s2) switched off</span>
<span class="co">#&gt; dist is assumed to be in decimal degrees (arc_degrees).</span>
<span class="co">#&gt; although coordinates are longitude/latitude, st_intersection assumes that they are planar</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; bdc_coordinates_country_inconsistent:</span>
<span class="co">#&gt; Flagged 656 records.</span>
<span class="co">#&gt; One column was added to the database.</span></code></pre></div>
</div>
<div id="saving-records-not-geo-referenced-but-containing-locality-information" class="section level2">
<h2 class="hasAnchor">
<a href="#saving-records-not-geo-referenced-but-containing-locality-information" class="anchor"></a>9 - Saving records not geo-referenced but containing locality information</h2>
<p><em>ENRICHMENT</em>. Coordinates can be derived from a detailed description of the locality associated with records in a process called retrospective geo-referencing.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">xyFromLocality</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bdc_coordinates_from_locality.html">bdc_coordinates_from_locality</a></span><span class="op">(</span>
  data <span class="op">=</span> <span class="va">check_pf</span>,
  locality <span class="op">=</span> <span class="st">"locality"</span>,
  lon <span class="op">=</span> <span class="st">"decimalLongitude"</span>,
  lat <span class="op">=</span> <span class="st">"decimalLatitude"</span>
<span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; bdc_coordinates_from_locality </span>
<span class="co">#&gt; Found 1524 records missing or with invalid coordinates but with potentially useful information on locality.</span>
<span class="co">#&gt;  </span>
<span class="co">#&gt; Check database in: C:/Users/Bruno R. Ribeiro/Desktop/bdc/Output/Check/01_coordinates_from_locality.csv</span></code></pre></div>
</div>
<div id="report" class="section level2">
<h2 class="hasAnchor">
<a href="#report" class="anchor"></a>Report</h2>
<p>Here we create a column named “.summary” summing up the results of all <strong>VALIDATION</strong> tests (those starting with “.”). This column is <strong>FALSE</strong> when a record is flagged as FALSE in any data quality test (i.e. potentially invalid or suspect record).</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">check_pf</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bdc_summary_col.html">bdc_summary_col</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">check_pf</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; bdc_summary_col:</span>
<span class="co">#&gt; Flagged 2886 records.</span>
<span class="co">#&gt; One column was added to the database.</span></code></pre></div>
<p><br></p>
<p><br></p>
<p>Creating a report summarizing the results of all tests.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">report</span> <span class="op">&lt;-</span>
  <span class="fu"><a href="../reference/bdc_create_report.html">bdc_create_report</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">check_pf</span>,
                    database_id <span class="op">=</span> <span class="st">"database_id"</span>,
                    workflow_step <span class="op">=</span> <span class="st">"prefilter"</span><span class="op">)</span>
<span class="co">#&gt; Carregando pacotes exigidos: DT</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; bdc_create_report:</span>
<span class="co">#&gt; Check the report summarizing the results of the prefilter in:</span>
<span class="co">#&gt; Output/Report</span></code></pre></div>
<p><br></p>
</div>
<div id="figures" class="section level2">
<h2 class="hasAnchor">
<a href="#figures" class="anchor"></a>Figures</h2>
<p>Here we create figures (bar plots and maps) to make the interpretation of the results of data quality tests easier. See some examples below.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/bdc_create_figures.html">bdc_create_figures</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">check_pf</span>,
                   database_id <span class="op">=</span> <span class="st">"database_id"</span>,
                   workflow_step <span class="op">=</span> <span class="st">"prefilter"</span><span class="op">)</span></code></pre></div>
<p><br></p>
<div class="figure">
<img src="https://github.com/brunobrr/bdc/raw/master/inst/extdata/example_figures/prefilter_.coordinates_country_inconsistent_MAP.png" style="width:20cm" alt=""><p class="caption"><strong>Coordinates country inconsistent</strong></p>
</div>
<p><br></p>
<div class="figure">
<img src="https://github.com/brunobrr/bdc/raw/master/inst/extdata/example_figures/prefilter_coordinates_transposed_MAP.png" style="width:20cm" alt=""><p class="caption"><strong>Transposed coordinates</strong></p>
</div>
<p><br></p>
<div class="figure">
<img src="https://github.com/brunobrr/bdc/raw/master/inst/extdata/example_figures/prefilter_summary_all_tests_BAR.png" style="width:20cm" alt=""><p class="caption"><strong>Summary of all tests of the pre-filter step</strong></p>
</div>
<p><br></p>
</div>
<div id="filtering-the-database" class="section level2">
<h2 class="hasAnchor">
<a href="#filtering-the-database" class="anchor"></a>Filtering the database</h2>
<p>We can remove records flagged as erroneous or suspect to obtain a “clean” database. Records missing names or coordinates, outside a region of interest or from distrustful sources are rarely suitable for biodiversity analyses. We can use the column <strong>.summary</strong> to filter valid records passing in all tests (i.e., flagged as “TRUE”). Next, we use the <em>bdc_filter_out_falgs</em> function to remove all tests’ columns (that is, those starting with “.”).</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">output</span> <span class="op">&lt;-</span>
  <span class="va">check_pf</span> <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">.summary</span> <span class="op">==</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/bdc_filter_out_flags.html">bdc_filter_out_flags</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">.</span>, col_to_remove <span class="op">=</span> <span class="st">"all"</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; bdc_fiter_out_flags:</span>
<span class="co">#&gt; The following columns were removed from the database:</span>
<span class="co">#&gt; .scientificName_empty, .coordinates_empty, .coordinates_outOfRange, .basisOfRecords_notStandard, .coordinates_country_inconsistent, .summary</span></code></pre></div>
</div>
<div id="saving-the-database" class="section level2">
<h2 class="hasAnchor">
<a href="#saving-the-database" class="anchor"></a>Saving the database</h2>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">output</span> <span class="op">%&gt;%</span>
  <span class="fu">qs</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/qs/man/qsave.html">qsave</a></span><span class="op">(</span><span class="va">.</span>,
            <span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="st">"Output"</span>, <span class="st">"Intermediate"</span>, <span class="st">"01_prefilter_database.qs"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Bruno Ribeiro, Geiziane Tessarolo, Santiago Velazco, Lucas Jardim, Karlo Guidoni-Martins.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
